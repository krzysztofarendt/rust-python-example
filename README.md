# Example project mixing Python and Rust code

## Introduction

This is an example of how to setup a Python project with an extension module
written in Rust.

This is quite simple thanks to the available tools:
- [uv](https://docs.astral.sh/uv/) for managing Python project
- [maturin](https://www.maturin.rs/) crate for exporting your Rust code to a Python module
- [PyO3](https://pyo3.rs/) crate for generating Rust bindings for Python
- [cargo](https://doc.rust-lang.org/cargo/) for standard management of Rust code

`cargo` is not needed unless you want to also compile some additional binaries
or have Rust-only unit tests.

## Project setup

Steps to setup a similar project:
```bash
uv tool install maturin
uv init --build-backend maturin rustpy
uvx maturin develop
uv sync
```

## Project structure

```
.
├── src         # Your Rust code lives here
│   └── rustpy  # Your Python code lives here
└── target
    ├── debug   # Debug builds
    ├── release # Shared lib. compiled with `cargo build --release`
    └── wheels  # Wheels generated with `maturin build`
```

This project structure allows to mix Python and Rust code. Rust code is compiled
into a Python extension module and can be imported in Python.

`cargo` by default expects the code to be in `src/` and we are sticking to it.
`uv` have several default paths it looks into for the code and `src/rustpy` is
one of them. `maturin` which is our build backend knows about the location of
the Python code thanks to the `[tool.maturin]` section in `pyproject.toml`.

Such project is very flexible, because you can experiment with the design
in Python and when things solidify, they can be rewritten to Rust for better
performance and safety.

## Code

Check out the example functions and classes in `src/`. A lot of the code was
autogenerated as an example by the command `uv --build-backend maturin rustpy`.
I just added few more functions and a class based on the documentation of
[maturin](https://www.maturin.rs/) and [PyO3](https://pyo3.rs/).

If you want to use your extention written in Rust with a Python-native feeling,
you need to add the support for type and docstring hints in your IDE.
These hints are stored in `.pyi` files and in native Python modules they are
typically autogenerated when making a package distribution.
Unfortunately, as of 2025, for Rust extensions these files must be created
manually. Check out the example in `src/rustpy/_core.pyi`.
It is essentially a valid Python code with function/class declarations
but without the implementations.
`maturin` will export these hints to the package distribution when
you run `maturin build`.

## Example script

The example code can be run with:
```bash
uv run rustpy
```

The above command will run the `main()` function defined in
`src/rustpy/__init__.py`.

The `rustpy` command is defined in `pyproject.toml`
(section `[projects.scripts]`).

## Managing Python dependencies

Just use `uv` as usual, e.g.:
```bash
uv add numpy
```

## Managing Rust dependencies

Just use `cargo` as usual, e.g.:
```bash
cargo add ndarray
```
